<!DOCTYPE html><html><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="description" content="kindquiet"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="alternative" href="/atom.xml" title="kindquiet素食勤俭敬老孝慈" type="application/atom+xml"><link rel="icon" href="/favicon.ico"><title>kindquiet素食勤俭敬老孝慈</title><meta name="keywords" content="centos,素食"><meta name="description" content="kindquiet素食勤俭敬老孝慈"><script>var _hmt = _hmt || [];(function() {  var hm = document.createElement("script");  hm.src = "//hm.baidu.com/hm.js?33ec0e4a308e2f174e68f15c700d8b5d";  var s = document.getElementsByTagName("script")[0];   s.parentNode.insertBefore(hm, s);})();</script><link rel="stylesheet" href="/css/style.css" type="text/css"><!--[if lt IE 9]><script>(function(a,b){a="abbr article aside audio bdi canvas data datalist details dialog figcaption figure footer header hgroup main mark meter nav output progress section summary template time video".split(" ");for(b=a.length-1;b>=0;b--)document.createElement(a[b])})()</script><![endif]--></head><body><header class="site-head"><div class="inner"><h1 class="site-title u-fl"><a href="/">kindquiet素食勤俭敬老孝慈</a></h1><nav class="site-nav u-fr"><ul class="site-nav__list"><li class="site-nav__item"><a href="/" class="site-nav__link">Home</a></li><li class="site-nav__item"><a href="/archives" class="site-nav__link">Archives</a></li></ul></nav></div></header><section class="site-content"><main class="site-main"><article class="post"><header class="post__head"><time datetime="2010-04-27T01:14:26.000Z" class="post__time">四月 27, 2010</time><h1 class="post__title"><a href="/2010/04/27/w/e5-81-a5-e5-ba-b7-e7-b1-bb-e4-bc-98-e7-a7-80-e5-9b-be-e4-b9-a6-e5-92-8c-e4-b8-ad-e5-8c-bb-e7-b1-bb-e7-bb-8f-e5-85-b8-e5-9b-be-e4-b9-a6/">健康类优秀图书和中医类经典图书</a></h1></header><div class="post__main"><p>这样吃最健康</p>
<p><img src="http://veryi.com/w/wp-content/uploads/姜医师.gif" alt=""></p>
<pre><code>这样吃最健康2:这样养育孩子最健康 

这样吃最健康3:姜医师的餐桌 

这样吃最健康4:善待癌症最健康

不生病之真法:揭开人类生命健康之奥秘 - 张家瑞

不生病之真法(续) - 张家瑞

人之自然本能&amp;nbsp; - 张家瑞

半路出家 - 张家瑞

圆运动的古中医学 - 彭子益

单桂敏灸除百病 单桂敏

小穴位大健康(随书赠送同名超长DVD光盘)&amp;nbsp; 李智

中国健康调查报告:膳食与疾病关系的惊人发现 - T&amp;middot;柯林&amp;middot;坎贝尔

-<span class="ruby">-------------------------------
</span>
以下图书必读文言原版

神农本草经

黄帝内经素问

黄帝内经灵枢

金匮要略

伤寒论

难经

陈修园医学全书

医宗金鉴

&amp;nbsp;
</code></pre></div><footer class="post__foot u-cf"><a href="/2010/04/27/w/e5-81-a5-e5-ba-b7-e7-b1-bb-e4-bc-98-e7-a7-80-e5-9b-be-e4-b9-a6-e5-92-8c-e4-b8-ad-e5-8c-bb-e7-b1-bb-e7-bb-8f-e5-85-b8-e5-9b-be-e4-b9-a6/#comments" class="post__foot-link u-fr">评论</a></footer></article><article class="post"><header class="post__head"><time datetime="2010-04-16T05:49:21.000Z" class="post__time">四月 16, 2010</time><h1 class="post__title"><a href="/2010/04/16/w/linux-e6-97-b6-e5-8c-ba-e5-92-8c-e6-97-b6-e9-97-b4/">Linux时区和时间</a></h1></header><div class="post__main"><p>如果服务器时区设置错误，比如不是CST而是EDT，用户可能会抱怨白天发布的文章，显示却是半夜。</p>
<pre><code>查看当前时区

date -R

查看硬件bios时间

hwclock -r

Linux的系统时区是通过符号连接<span class="regexp">/etc/</span>localtime来得到的。可以通过tzselect命令来设置时区。如果没有该命令，

复制相应的时区文件，替换系统时区文件；或者创建链接文件

cp <span class="regexp">/usr/</span>share<span class="regexp">/zoneinfo/</span>$主时区<span class="regexp">/$次时区 /</span>etc/localtime

在中国可以使用：

cp <span class="regexp">/usr/</span>share<span class="regexp">/zoneinfo/</span>Asia<span class="regexp">/Shanghai /</span>etc/localtime

也可以通过命令

ln &amp;ndash;s <span class="regexp">/usr/</span>share<span class="regexp">/zoneinfo/</span>Asia<span class="regexp">/Shanghai /</span>etc/localtime

来将时区设置为亚洲的上海。

配置文件<span class="regexp">/etc/</span>sysconfig<span class="regexp">/clock可用来设置用户选择何种方式显示时间。如果硬件时钟为本地时间，则UTC设为0，并且不用设置环境变量TZ。如果硬件时钟为UTC时间，则要设置UTC为1，并设置环境变量TZ（或配置文件/</span>etc<span class="regexp">/TZ）为时区信息，如&amp;ldquo;Asia/</span>Shanghai&amp;rdquo;。

cat <span class="regexp">/etc/</span>sysconfig/clock 

# The ZONE parameter is only evaluated by system-config-date.

# The timezone of the system is defined by the contents of <span class="regexp">/etc/</span>localtime.

ZONE=&amp;quot;Asia/Shanghai&amp;quot;

UTC=<span class="literal">false</span>

ARC=<span class="literal">false</span>

将当前时间和日期写入BIOS，避免重启后失效

hwclock -w
</code></pre></div><footer class="post__foot u-cf"><a href="/2010/04/16/w/linux-e6-97-b6-e5-8c-ba-e5-92-8c-e6-97-b6-e9-97-b4/#comments" class="post__foot-link u-fr">评论</a></footer></article><article class="post"><header class="post__head"><time datetime="2010-03-31T09:23:38.000Z" class="post__time">三月 31, 2010</time><h1 class="post__title"><a href="/2010/03/31/w/myisaminnodb-e9-82-a3-e4-b8-aa-e6-9b-b4-e5-bf-ab-e4-b8-80-e4-ba-9b/">myisam,innodb那个更快一些</a></h1></header><div class="post__main"><p>mysqlslap -hlocalhost -uroot —engine=innodb —auto-generate-sql-write-number=100000 —auto-generate-sql-guid-primary —concurrency=5,50,500 —number-of-queries=500000 —iterations=2 —number-char-cols=10 —number-int-cols=10 —auto-generate-sql —create-schema=sbtest —auto-generate-sql-load-type=mixed</p>
<pre><code>Benchmark

&amp;nbsp;&amp;nbsp;&amp;nbsp; Running <span class="keyword">for</span> engine innodb

&amp;nbsp;&amp;nbsp;&amp;nbsp; Average <span class="built_in">number</span> <span class="operator">of</span> <span class="built_in">seconds</span> <span class="built_in">to</span> run all queries: <span class="number">96.510</span> <span class="built_in">seconds</span>

&amp;nbsp;&amp;nbsp;&amp;nbsp; Minimum <span class="built_in">number</span> <span class="operator">of</span> <span class="built_in">seconds</span> <span class="built_in">to</span> run all queries: <span class="number">95.215</span> <span class="built_in">seconds</span>

&amp;nbsp;&amp;nbsp;&amp;nbsp; Maximum <span class="built_in">number</span> <span class="operator">of</span> <span class="built_in">seconds</span> <span class="built_in">to</span> run all queries: <span class="number">97.805</span> <span class="built_in">seconds</span>

&amp;nbsp;&amp;nbsp;&amp;nbsp; Number <span class="operator">of</span> clients running queries: <span class="number">5</span>

&amp;nbsp;&amp;nbsp;&amp;nbsp; Average <span class="built_in">number</span> <span class="operator">of</span> queries per client: <span class="number">100000</span>

Benchmark

&amp;nbsp;&amp;nbsp;&amp;nbsp; Running <span class="keyword">for</span> engine innodb

&amp;nbsp;&amp;nbsp;&amp;nbsp; Average <span class="built_in">number</span> <span class="operator">of</span> <span class="built_in">seconds</span> <span class="built_in">to</span> run all queries: <span class="number">97.762</span> <span class="built_in">seconds</span>

&amp;nbsp;&amp;nbsp;&amp;nbsp; Minimum <span class="built_in">number</span> <span class="operator">of</span> <span class="built_in">seconds</span> <span class="built_in">to</span> run all queries: <span class="number">96.139</span> <span class="built_in">seconds</span>

&amp;nbsp;&amp;nbsp;&amp;nbsp; Maximum <span class="built_in">number</span> <span class="operator">of</span> <span class="built_in">seconds</span> <span class="built_in">to</span> run all queries: <span class="number">99.386</span> <span class="built_in">seconds</span>

&amp;nbsp;&amp;nbsp;&amp;nbsp; Number <span class="operator">of</span> clients running queries: <span class="number">50</span>

&amp;nbsp;&amp;nbsp;&amp;nbsp; Average <span class="built_in">number</span> <span class="operator">of</span> queries per client: <span class="number">10000</span>

Benchmark

&amp;nbsp;&amp;nbsp;&amp;nbsp; Running <span class="keyword">for</span> engine innodb

&amp;nbsp;&amp;nbsp;&amp;nbsp; Average <span class="built_in">number</span> <span class="operator">of</span> <span class="built_in">seconds</span> <span class="built_in">to</span> run all queries: <span class="number">142.323</span> <span class="built_in">seconds</span>

&amp;nbsp;&amp;nbsp;&amp;nbsp; Minimum <span class="built_in">number</span> <span class="operator">of</span> <span class="built_in">seconds</span> <span class="built_in">to</span> run all queries: <span class="number">140.955</span> <span class="built_in">seconds</span>

&amp;nbsp;&amp;nbsp;&amp;nbsp; Maximum <span class="built_in">number</span> <span class="operator">of</span> <span class="built_in">seconds</span> <span class="built_in">to</span> run all queries: <span class="number">143.691</span> <span class="built_in">seconds</span>

&amp;nbsp;&amp;nbsp;&amp;nbsp; Number <span class="operator">of</span> clients running queries: <span class="number">500</span>

&amp;nbsp;&amp;nbsp;&amp;nbsp; Average <span class="built_in">number</span> <span class="operator">of</span> queries per client: <span class="number">1000</span>

<span class="comment">------------------------------------- </span>

&amp;nbsp;mysqlslap -hlocalhost -uroot <span class="comment">--engine=myisam --auto-generate-sql-write-number=100000 --auto-generate-sql-guid-primary --concurrency=5,50,500 --number-of-queries=500000 --iterations=2 --number-char-cols=10 --number-int-cols=10 --auto-generate-sql --create-schema=sbtest --auto-generate-sql-load-type=mixed</span>

Benchmark

&amp;nbsp;&amp;nbsp;&amp;nbsp; Running <span class="keyword">for</span> engine myisam

&amp;nbsp;&amp;nbsp;&amp;nbsp; Average <span class="built_in">number</span> <span class="operator">of</span> <span class="built_in">seconds</span> <span class="built_in">to</span> run all queries: <span class="number">117.924</span> <span class="built_in">seconds</span>

&amp;nbsp;&amp;nbsp;&amp;nbsp; Minimum <span class="built_in">number</span> <span class="operator">of</span> <span class="built_in">seconds</span> <span class="built_in">to</span> run all queries: <span class="number">114.445</span> <span class="built_in">seconds</span>

&amp;nbsp;&amp;nbsp;&amp;nbsp; Maximum <span class="built_in">number</span> <span class="operator">of</span> <span class="built_in">seconds</span> <span class="built_in">to</span> run all queries: <span class="number">121.404</span> <span class="built_in">seconds</span>

&amp;nbsp;&amp;nbsp;&amp;nbsp; Number <span class="operator">of</span> clients running queries: <span class="number">5</span>

&amp;nbsp;&amp;nbsp;&amp;nbsp; Average <span class="built_in">number</span> <span class="operator">of</span> queries per client: <span class="number">100000</span>

Benchmark

&amp;nbsp;&amp;nbsp;&amp;nbsp; Running <span class="keyword">for</span> engine myisam

&amp;nbsp;&amp;nbsp;&amp;nbsp; Average <span class="built_in">number</span> <span class="operator">of</span> <span class="built_in">seconds</span> <span class="built_in">to</span> run all queries: <span class="number">162.244</span> <span class="built_in">seconds</span>

&amp;nbsp;&amp;nbsp;&amp;nbsp; Minimum <span class="built_in">number</span> <span class="operator">of</span> <span class="built_in">seconds</span> <span class="built_in">to</span> run all queries: <span class="number">161.278</span> <span class="built_in">seconds</span>

&amp;nbsp;&amp;nbsp;&amp;nbsp; Maximum <span class="built_in">number</span> <span class="operator">of</span> <span class="built_in">seconds</span> <span class="built_in">to</span> run all queries: <span class="number">163.211</span> <span class="built_in">seconds</span>

&amp;nbsp;&amp;nbsp;&amp;nbsp; Number <span class="operator">of</span> clients running queries: <span class="number">50</span>

&amp;nbsp;&amp;nbsp;&amp;nbsp; Average <span class="built_in">number</span> <span class="operator">of</span> queries per client: <span class="number">10000</span>

Benchmark

&amp;nbsp;&amp;nbsp;&amp;nbsp; Running <span class="keyword">for</span> engine myisam

&amp;nbsp;&amp;nbsp;&amp;nbsp; Average <span class="built_in">number</span> <span class="operator">of</span> <span class="built_in">seconds</span> <span class="built_in">to</span> run all queries: <span class="number">209.235</span> <span class="built_in">seconds</span>

&amp;nbsp;&amp;nbsp;&amp;nbsp; Minimum <span class="built_in">number</span> <span class="operator">of</span> <span class="built_in">seconds</span> <span class="built_in">to</span> run all queries: <span class="number">202.708</span> <span class="built_in">seconds</span>

&amp;nbsp;&amp;nbsp;&amp;nbsp; Maximum <span class="built_in">number</span> <span class="operator">of</span> <span class="built_in">seconds</span> <span class="built_in">to</span> run all queries: <span class="number">215.762</span> <span class="built_in">seconds</span>

&amp;nbsp;&amp;nbsp;&amp;nbsp; Number <span class="operator">of</span> clients running queries: <span class="number">500</span>

&amp;nbsp;&amp;nbsp;&amp;nbsp; Average <span class="built_in">number</span> <span class="operator">of</span> queries per client: <span class="number">1000</span>
</code></pre></div><footer class="post__foot u-cf"><a href="/2010/03/31/w/myisaminnodb-e9-82-a3-e4-b8-aa-e6-9b-b4-e5-bf-ab-e4-b8-80-e4-ba-9b/#comments" class="post__foot-link u-fr">评论</a></footer></article><article class="post"><header class="post__head"><time datetime="2010-03-19T06:01:58.000Z" class="post__time">三月 19, 2010</time><h1 class="post__title"><a href="/2010/03/19/w/apache-e6-97-a0-e6-b3-95-e5-90-af-e5-8a-a8-e6-b2-a1-e6-9c-89-e9-94-99-e8-af-af-e6-8f-90-e7-a4-ba-e7-9a-84-e5-8f-af-e8-83-bd-e5-8e-9f-e5-9b-a0/">apache无法启动没有错误提示的可能原因</a></h1></header><div class="post__main"><p>环境:CentOS 5,Apache/2.2</p>
<pre><code>apache运行正常，重启后不能启动，没有任何错误提示。

排错过程：

检查硬盘分区，空闲容量还很多；

检查错误日志，没有新的内容；

怀疑有人修改配置文件，注释部分内容；

最终找到了原因，原来是apache的error_<span class="built_in">log</span>达到了<span class="number">2147483647</span> byte，清空error_<span class="built_in">log</span>，正常启动。

同样，access_<span class="built_in">log</span>文件超过<span class="number">2</span>G也会导致不能启动。

当时没有注意<span class="number">2147483647</span>这个数字就是<span class="number">2</span>G-<span class="number">1</span>，其实，从启动是日志中没有任何内容也可以推理问题和日志文件有关。
</code></pre></div><footer class="post__foot u-cf"><a href="/2010/03/19/w/apache-e6-97-a0-e6-b3-95-e5-90-af-e5-8a-a8-e6-b2-a1-e6-9c-89-e9-94-99-e8-af-af-e6-8f-90-e7-a4-ba-e7-9a-84-e5-8f-af-e8-83-bd-e5-8e-9f-e5-9b-a0/#comments" class="post__foot-link u-fr">评论</a></footer></article><article class="post"><header class="post__head"><time datetime="2010-03-04T06:32:39.000Z" class="post__time">三月 4, 2010</time><h1 class="post__title"><a href="/2010/03/04/w/linux-e7-9a-84-e4-b8-ad-e6-96-87-e5-a4-84-e7-90-86-e5-92-8c-e6-96-87-e4-bb-b6-e5-90-8d-e4-b9-b1-e7-a0-81-e8-bd-ac-e6-8d-a2/">linux的中文处理和文件名乱码转换</a></h1></header><div class="post__main"><p>1、locale</p>
<p>/etc/sysconfig/i18n </p>
<pre><code><span class="comment">#LANG=&amp;quot;zh_CN.GB18030&amp;quot;</span>

<span class="comment">#LC_ALL=&amp;quot;zh_CN.GB18030&amp;quot;</span>

<span class="constant">LANG</span>=&amp;quot;zh_CN.<span class="constant">UTF</span>-<span class="number">8</span>&amp;quot;

<span class="constant">LC_ALL</span>=&amp;quot;zh_CN.<span class="constant">UTF</span>-<span class="number">8</span>&amp;quot;

<span class="constant">LANGUAGE</span>=&amp;quot;en_US.<span class="constant">UTF</span>-<span class="number">8</span><span class="symbol">:zh_CN</span>.<span class="constant">GB18030</span><span class="symbol">:zh_CN</span>.<span class="constant">GB2312</span><span class="symbol">:zh_CN</span><span class="symbol">:en_US</span>.<span class="constant">UTF</span>-<span class="number">8</span>&amp;quot;

<span class="constant">SYSFONT</span>=&amp;quot;latarcyrheb-sun16&amp;quot;
</code></pre><p>2、samba</p>
<p>/etc/samba/smb.conf</p>
<p>[global]</p>
<pre><code>DISPLAY <span class="variable">CHARSET=</span> utf8

UNIX <span class="variable">CHARSET =</span> utf8

<span class="comment">#UNIX CHARSET = cp936</span>

DOS <span class="variable">CHARSET =</span> utf8
</code></pre><h1 id="关键是UNIX_CHARSET_=_utf8，其它可以不加">关键是UNIX CHARSET = utf8，其它可以不加</h1><p>3、文件名乱码转换</p>
<p>yum install convmv</p>
<p>convmv -f GBK -t UTF-8 *.zip —notest</p>
<p>—notest不加测试，直接转换，建议先测试。</p>
</div><footer class="post__foot u-cf"><a href="/2010/03/04/w/linux-e7-9a-84-e4-b8-ad-e6-96-87-e5-a4-84-e7-90-86-e5-92-8c-e6-96-87-e4-bb-b6-e5-90-8d-e4-b9-b1-e7-a0-81-e8-bd-ac-e6-8d-a2/#comments" class="post__foot-link u-fr">评论</a></footer></article><article class="post"><header class="post__head"><time datetime="2010-03-03T04:50:31.000Z" class="post__time">三月 3, 2010</time><h1 class="post__title"><a href="/2010/03/03/w/e5-a4-a9-e5-9c-86-e5-9c-b0-e6-96-b9-e5-8f-a4-e4-ba-ba-e8-ae-a4-e4-b8-ba-e5-9c-b0-e6-98-af-e6-96-b9-e7-9a-84-e5-90-97-ef-bc-9f/">天圆地方--古人认为地是正方的吗？</a></h1></header><div class="post__main"><p>天圆地方就是天圆地方天方地圆。</p>
<p>天和地是圆的，天与地是广大的。</p>
<pre><code>假设一个人在探索地球的时候，没有卫星，在大地上行走，无论那个方向都走不到边界，一望无际，这个人会说：<span class="keyword">&amp;</span><span class="tag">ldquo</span>;啊，地是方的。<span class="keyword">&amp;</span><span class="tag">ldquo</span>;可能吗？
</code></pre><p>我们的老祖宗早就认识到了天人合一，看到太阳和月亮的圆形自然就会推论出地球是圆的。</p>
<p>&ldquo;方&rdquo;，不是四个角九十度的方。</p>
<pre><code>《论语.学而》&amp;quot;有朋自远方来，不亦乐乎&amp;ldquo;，&amp;ldquo;方&amp;rdquo;，方非方向之类，而是&amp;ldquo;旁&amp;rdquo;的通假，广大的意思。《尚书&amp;middot;立政》，&amp;ldquo;方行天下，至于海表&amp;rdquo;，&amp;ldquo;圣人之道&amp;rdquo;之&amp;ldquo;行&amp;rdquo;，是&amp;ldquo;方行&amp;rdquo;，君子&amp;ldquo;行&amp;rdquo;圣人之道，也是&amp;ldquo;方行&amp;rdquo;，要&amp;ldquo;方行天下，至于海表&amp;rdquo;，这才算&amp;ldquo;行&amp;rdquo;圣人之道之&amp;ldquo;行&amp;rdquo;。

《论语.学而》&amp;ldquo;贫而乐，富而好礼&amp;rdquo;，乐，yue，歌舞升平，连&amp;ldquo;贫&amp;rdquo;者弱者都能歌舞升平，而只有&amp;ldquo;不愠&amp;rdquo;才可能歌舞升平，连&amp;ldquo;贫&amp;rdquo;者都能&amp;ldquo;不愠&amp;rdquo;，这才是真正的&amp;ldquo;人不愠&amp;rdquo;，这才是&amp;ldquo;大同&amp;rdquo;。这里，&amp;ldquo;礼乐&amp;rdquo;并举，并不是说&amp;ldquo;礼&amp;rdquo;归富者，&amp;ldquo;乐&amp;rdquo;归贫者，而是&amp;ldquo;互文&amp;rdquo;的修辞手法，无论贫富，都&amp;ldquo;乐&amp;rdquo;且好&amp;ldquo;礼&amp;rdquo;。（论语解释引用自缠中说禅博客）
</code></pre></div><footer class="post__foot u-cf"><a href="/2010/03/03/w/e5-a4-a9-e5-9c-86-e5-9c-b0-e6-96-b9-e5-8f-a4-e4-ba-ba-e8-ae-a4-e4-b8-ba-e5-9c-b0-e6-98-af-e6-96-b9-e7-9a-84-e5-90-97-ef-bc-9f/#comments" class="post__foot-link u-fr">评论</a></footer></article><article class="post"><header class="post__head"><time datetime="2010-03-02T08:20:14.000Z" class="post__time">三月 2, 2010</time><h1 class="post__title"><a href="/2010/03/02/w/centos-linux-e4-b8-8aflvswf-e8-a7-86-e9-a2-91-e6-9c-8d-e5-8a-a1-e5-99-a8-e6-9e-b6-e8-ae-be/">centos linux 上flv/swf视频服务器架设</a></h1></header><div class="post__main"><p>在互联网上播放视频有两种方式，一种是通过HTTP协议访问视频文件；另外一种就是采用专门的流媒体服务器如red5。以下为在centos 5服务器上支持拖放的视频服务器安装配置。</p>
<p>web服务器安装：</p>
<pre><code>wget http:<span class="regexp">//sysoev</span>.ru/nginx/nginx-<span class="number">0</span>.<span class="number">7.65</span>.tar.gz

tar zxf nginx-<span class="number">0</span>.<span class="number">7.65</span>.tar.gz -C /usr/<span class="keyword">local</span>/src

cd /usr/<span class="keyword">local</span>/src/nginx-<span class="number">0</span>.<span class="number">7.65</span>

groupadd www

useradd -d /var/www/nginx -g www www

./configure --prefix=<span class="regexp">/usr/local</span><span class="regexp">/nginx --user=www --group=www --with-http_flv_module --with-http_gzip_static_module --with-http_stub_status_module --with-cc=gcc --with-cc-opt=&amp;quot; -O3&amp;quot;

make &amp;amp;&amp;amp; make install

cd /usr</span><span class="regexp">/local/nginx</span><span class="regexp">/conf

cat nginx.conf

user www;

worker_processes&amp;nbsp; 1;

error_log&amp;nbsp; logs/error</span>.<span class="keyword">log</span>;

pid&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; logs/nginx.pid;

events {

&amp;nbsp;&amp;nbsp;&amp;nbsp; worker_connections&amp;nbsp; <span class="number">1024</span>;

}

http {

&amp;nbsp;&amp;nbsp;&amp;nbsp; include&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; mime.types;

&amp;nbsp;&amp;nbsp;&amp;nbsp; default_type&amp;nbsp; application/octet-stream;

&amp;nbsp;&amp;nbsp;&amp;nbsp; sendfile&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; on;

&amp;nbsp;&amp;nbsp;&amp;nbsp; keepalive_timeout&amp;nbsp; <span class="number">65</span>;

&amp;nbsp;&amp;nbsp;&amp;nbsp; server {

&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; <span class="keyword">listen</span>&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; <span class="number">81</span>;

&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; server_name&amp;nbsp; localhost;

&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; root&amp;nbsp;&amp;nbsp;&amp;nbsp; <span class="regexp">/var/www</span><span class="regexp">/nginx;

&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; index&amp;nbsp;&amp;nbsp; index.html;

&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; charset utf-8;

&amp;nbsp;&amp;nbsp;&amp;nbsp; # important!

&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; location ~ \.flv {

&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; flv;

&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; }

&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; error_page&amp;nbsp;&amp;nbsp; 500 502 503 504&amp;nbsp; /</span><span class="number">50</span><span class="keyword">x</span>.html;

&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; location = <span class="regexp">/50x.html {

&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; root&amp;nbsp;&amp;nbsp; html;

&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; }

&amp;nbsp;&amp;nbsp;&amp;nbsp; }

}

启动

/usr</span><span class="regexp">/local/nginx</span><span class="regexp">/sbin/nginx</span> 

重启

/usr/<span class="keyword">local</span>/nginx/sbin/nginx -<span class="keyword">s</span> reload

<span class="keyword">mkdir</span> -p /var/www/nginx

cd /var/www/nginx

其次，需要有一个能够播放Flv视频的播放器，很显然，它还需要能够嵌入到网页中。目前比较流行的，功能上也还比较完善的一个Flv播放器就是 JW FLV Media Player（也称为 jwplayer）。网址是：

&amp;nbsp;&amp;nbsp;&amp;nbsp; http:<span class="regexp">//www</span>.longtailvideo.com/players/jw-flv-player/

下载mediaplayer-viral.zip并解压到/var/www/nginx

将播放器嵌入到你的视频播放网页中。嵌入的方式有两种：

直接嵌入，使用Object/Embed代码嵌入：

cat&amp;nbsp; <span class="keyword">index</span>.html

&amp;<span class="keyword">lt</span>;html&amp;<span class="keyword">gt</span>;

&amp;<span class="keyword">lt</span>;head&amp;<span class="keyword">gt</span>;

&amp;<span class="keyword">lt</span>;meta http-equiv=&amp;quot;content-type&amp;quot; content=&amp;quot;text/html; charset=UTF-<span class="number">8</span>&amp;quot;&amp;<span class="keyword">gt</span>;&amp;<span class="keyword">lt</span>;title&amp;<span class="keyword">gt</span>;veryi.com&amp;<span class="keyword">lt</span>;<span class="regexp">/title&amp;gt;

&amp;lt;/head</span>&amp;<span class="keyword">gt</span>;

&amp;<span class="keyword">lt</span>;body&amp;<span class="keyword">gt</span>;

&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;<span class="keyword">lt</span>;h3&amp;<span class="keyword">gt</span>;start&amp;<span class="keyword">lt</span>;<span class="regexp">/h3&amp;gt;

&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;p&amp;gt;click to play &amp;lt;/p</span>&amp;<span class="keyword">gt</span>;

&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;<span class="keyword">lt</span>;!-- START OF THE PLAYER EMBEDDING TO COPY-PASTE --&amp;<span class="keyword">gt</span>;

&amp;nbsp;&amp;nbsp;&amp;nbsp; 

&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;<span class="keyword">lt</span>;object id=&amp;quot;player&amp;quot; classid=&amp;quot;clsid:D27CDB6E-AE6D-<span class="number">11</span>cf-<span class="number">96</span>B8-<span class="number">444553540000</span>&amp;quot; name=&amp;quot;player&amp;quot; width=&amp;quot;<span class="number">400</span>&amp;quot; height=&amp;quot;<span class="number">315</span>&amp;quot;&amp;<span class="keyword">gt</span>;

&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;<span class="keyword">lt</span>;param name=&amp;quot;movie&amp;quot; value=&amp;quot;player-viral.swf&amp;quot; <span class="regexp">/&amp;gt;

&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;param name=&amp;quot;allowfullscreen&amp;quot; value=&amp;quot;true&amp;quot; /</span>&amp;<span class="keyword">gt</span>;

&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;<span class="keyword">lt</span>;param name=&amp;quot;allowscriptaccess&amp;quot; value=&amp;quot;always&amp;quot; <span class="regexp">/&amp;gt;

&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;param name=&amp;quot;flashvars&amp;quot; value=&amp;quot;file=snatch1.flv&amp;quot; /</span>&amp;<span class="keyword">gt</span>;

&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;<span class="keyword">lt</span>;embed

&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; type=&amp;quot;application/<span class="keyword">x</span>-shockwave-flash&amp;quot;

&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; id=&amp;quot;player2&amp;quot;

&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; name=&amp;quot;player2&amp;quot;

&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; src=&amp;quot;player-viral.swf&amp;quot; 

&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; width=&amp;quot;<span class="number">400</span>&amp;quot; 

&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; height=&amp;quot;<span class="number">315</span>&amp;quot;

&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; allowscriptaccess=&amp;quot;always&amp;quot; 

&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; allowfullscreen=&amp;quot;true&amp;quot;

&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; flashvars=&amp;quot;file=snatch1.flv&amp;quot; 

&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; <span class="regexp">/&amp;gt;

&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;lt;/object</span>&amp;<span class="keyword">gt</span>;

&amp;nbsp;&amp;nbsp;&amp;nbsp; 

&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;<span class="keyword">lt</span>;!-- END OF THE PLAYER EMBEDDING --&amp;<span class="keyword">gt</span>;

&amp;<span class="keyword">lt</span>;<span class="regexp">/body&amp;gt;

&amp;lt;/html</span>&amp;<span class="keyword">gt</span>;

使用swfobject来嵌入Flash：

swfobject是一个很小的JavaScript脚本（<span class="number">10</span>k），该脚本引入了一个swfobject对象，用于在网页内嵌入Flash，并避免了上述的安全提示。swfobject已经得到了广泛的使用和好评。

swfobject在jwplayer包中也包含了一个，不过是很旧的<span class="number">1.5</span>版，建议使用最新的版本。本文写作时，最新的版本是<span class="number">2.2</span>。 swfobject可以从此下载（只需要其中的swfobject.js文件）：

&amp;nbsp;&amp;nbsp;&amp;nbsp; http:<span class="regexp">//code</span>.google.com/p/swfobject/

使用swfobject嵌入的代码如下：

&amp;<span class="keyword">lt</span>;html&amp;<span class="keyword">gt</span>;

&amp;<span class="keyword">lt</span>;head&amp;<span class="keyword">gt</span>;

&amp;<span class="keyword">lt</span>;script type=&amp;quot;text/JavaScript&amp;quot; src=&amp;quot;swfobject.js&amp;quot;&amp;<span class="keyword">gt</span>;&amp;<span class="keyword">lt</span>;<span class="regexp">/script&amp;gt;

&amp;lt;script type=&amp;quot;text/</span>JavaScript&amp;quot;&amp;<span class="keyword">gt</span>;

function createPlayer() {

&amp;nbsp;&amp;nbsp;&amp;nbsp; var flashvars = {

&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; file:&amp;quot;snatch1.flv&amp;quot;,

&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; type:&amp;quot;http&amp;quot;,

&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; image:&amp;quot;preview.jpg&amp;quot;,

&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; autostart:&amp;quot;false&amp;quot;,

&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; streamer:&amp;quot;start&amp;quot;

&amp;nbsp;&amp;nbsp;&amp;nbsp; }

&amp;nbsp;&amp;nbsp;&amp;nbsp; var params = {

&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; allowfullscreen:&amp;quot;true&amp;quot;,&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; allowscriptaccess:&amp;quot;always&amp;quot;

&amp;nbsp;&amp;nbsp;&amp;nbsp; }

&amp;nbsp;&amp;nbsp;&amp;nbsp; var attributes = {

&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; id:&amp;quot;player1&amp;quot;,&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; name:&amp;quot;player1&amp;quot;

&amp;nbsp;&amp;nbsp;&amp;nbsp; }

&amp;nbsp;&amp;nbsp;&amp;nbsp; swfobject.embedSWF(&amp;quot;player-viral.swf&amp;quot;, &amp;quot;placeholder1&amp;quot;, &amp;quot;<span class="number">320</span>&amp;quot;, &amp;quot;<span class="number">196</span>&amp;quot;, &amp;quot;<span class="number">9.0</span>.<span class="number">115</span>&amp;quot;, false, flashvars, params, attributes);

&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; }

&amp;<span class="keyword">lt</span>;<span class="regexp">/script&amp;gt;

&amp;nbsp;

&amp;lt;/head</span>&amp;<span class="keyword">gt</span>;

&amp;<span class="keyword">lt</span>;body onload=&amp;quot;createPlayer();&amp;quot;&amp;<span class="keyword">gt</span>;

&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;<span class="keyword">lt</span>;div id=&amp;quot;placeholder1&amp;quot;&amp;<span class="keyword">gt</span>;&amp;<span class="keyword">lt</span>;<span class="regexp">/div&amp;gt;

&amp;lt;/body</span>&amp;<span class="keyword">gt</span>;

&amp;<span class="keyword">lt</span>;<span class="regexp">/html&amp;gt;

附，媒体转换：

FFmpeg是一套可以用来记录、转换数字音频、视频，并能将其转化为流的开源计算机程序。它包括了目前领先的音/</span>视频编码库libavcodec,安装，使用http:<span class="regexp">//dag</span>.wieers.com/或者http:<span class="regexp">//www</span>.atrpms.net/的源：

yum install ffmpeg -<span class="keyword">y</span>

yum install ffmpeg-devel -<span class="keyword">y</span>

转换dvd的MPEG-<span class="number">2</span>格式的音频和视频数据VOB格式文件：

ffmpeg -i VTS_01_3.VOB -f flv -ar <span class="number">22050</span> -<span class="keyword">s</span> qvga -r <span class="number">15</span> -<span class="keyword">y</span> snatch1.flv

对ffmpeg无法解析的文件格式(wmv9，rm，rmvb等),

可以先用别的工具（mencoder）转换为 avi(ffmpeg能解析的)格式.

./mencoder /input/a.rmvb -oac lavc -lavcopts acodec=mp3:abitrate=<span class="number">64</span> -ovc xvid -xvidencopts bitrate=<span class="number">600</span> -of avi -o /output/a.avi

然后执行./ffmpeg -i &amp;quot;<span class="regexp">/opt/input</span><span class="regexp">/a.avi&amp;quot; -y -ab 32 -ar 22050 -b 800000 -s 640*480 /opt</span><span class="regexp">/output/a</span>.flv&amp;quot;就可以了。

如果运行ffmpeg出现错误

lame: output buffer too small (buffer <span class="keyword">index</span>: <span class="number">9405</span>, free bytes: <span class="number">387</span>)

解决方法：

wget http:<span class="regexp">//dl</span>.atrpms.net/all/lame-<span class="number">3.97</span>-<span class="number">16.0</span>.el5.i386.rpm

wget http:<span class="regexp">//dl</span>.atrpms.net/all/libmp3lame<span class="number">0</span>-<span class="number">3.97</span>-<span class="number">16.0</span>.el5.i386.rpm

rpm -hUv --nodeps --oldpackage libmp3lame<span class="number">0</span>-<span class="number">3.97</span>-<span class="number">16.0</span>.el5.i386.rpm&amp;nbsp; lame-<span class="number">3.97</span>-<span class="number">16.0</span>.el5.i386.rpm

To prevent updating libmp3lame<span class="number">0</span> <span class="keyword">and</span> lame again <span class="keyword">when</span> running &amp;lsquo;yum update&amp;rsquo;, be sure to edit /etc/yum.conf <span class="keyword">and</span> exclude these packages. Add the following line:

exclude=lame* libmp3lame*

(ffmpeg参数说明)：

控制画面参数

-r &amp;<span class="keyword">lt</span>;数值&amp;<span class="keyword">gt</span>; &amp;nbsp;&amp;nbsp;&amp;nbsp; 帧速率(非标准数值会导致音画不同步【标准值为<span class="number">15</span>或<span class="number">29.97</span>】)

-b &amp;<span class="keyword">lt</span>;比特率&amp;<span class="keyword">gt</span>; &amp;nbsp;&amp;nbsp;&amp;nbsp; 指定压缩比特率

控制声音参数

-ac &amp;<span class="keyword">lt</span>;数值&amp;<span class="keyword">gt</span>; &amp;nbsp;&amp;nbsp;&amp;nbsp; 设定声道数：<span class="number">1</span>为单声道，<span class="number">2</span>为立体声

-ar &amp;<span class="keyword">lt</span>;采样率&amp;<span class="keyword">gt</span>; &amp;nbsp;&amp;nbsp;&amp;nbsp; 设定声音采样率(<span class="number">8000</span>，<span class="number">11025</span>，<span class="number">22050</span>)

-ab &amp;<span class="keyword">lt</span>;比特率&amp;<span class="keyword">gt</span>; &amp;nbsp;&amp;nbsp;&amp;nbsp; 设定声音比特率(-ac设为立体声时要以一半比特率来设置，比如<span class="number">192</span>kbps的就设成<span class="number">96</span>)

-vol &amp;<span class="keyword">lt</span>;百分比&amp;<span class="keyword">gt</span>; &amp;nbsp;&amp;nbsp;&amp;nbsp; 设定音量大小，比如设定<span class="number">200</span>就会比原来的音量大<span class="number">2</span>倍

参考：

http:<span class="regexp">//linux</span>.cn/home/space-<span class="number">3</span>-<span class="keyword">do</span>-blog-id-<span class="number">136</span>.html
</code></pre></div><footer class="post__foot u-cf"><a href="/2010/03/02/w/centos-linux-e4-b8-8aflvswf-e8-a7-86-e9-a2-91-e6-9c-8d-e5-8a-a1-e5-99-a8-e6-9e-b6-e8-ae-be/#comments" class="post__foot-link u-fr">评论</a></footer></article><article class="post"><header class="post__head"><time datetime="2010-01-12T08:06:47.000Z" class="post__time">一月 12, 2010</time><h1 class="post__title"><a href="/2010/01/12/w/e4-bf-ae-e6-94-b9-e9-82-ae-e4-bb-b6smtp-e7-ab-af-e5-8f-a3-e8-a7-a3-e5-86-b3isp-e5-b0-81-e9-94-8125-e7-ab-af-e5-8f-a3-e4-b8-8d-e8-83-bd-e5-8f-91-e4-bf-a1/">修改邮件smtp端口解决ISP封锁25端口不能发信</a></h1></header><div class="post__main"><p>&nbsp; 邮件服务器的默认发送邮件端口是25，一些ISP会封锁25端口防止垃圾邮件的发送，这样就导致不能使用Foxmail、outlook等邮件客户端发送邮件。修改默认smtp端口就可以解决这个问题。下面的方法以CentOS linux上Postfix mail server为例，增加2626邮件发送端口。</p>
<p>方法一，使用linux iptables防火墙的端口重定向，适用于各种mail server：</p>
<p>修改/etc/sysconfig/iptables，在开头添加</p>
<p>*nat</p>
<pre><code><span class="attribute">:PREROUTING ACCEPT [0:0]</span>

<span class="attribute">:POSTROUTING ACCEPT [0:0]</span>

<span class="attribute">:OUTPUT ACCEPT [0:0]</span>

-A PREROUTING -p tcp -m tcp --dport 2626 -j REDIRECT --to-ports 25 

COMMIT
</code></pre><p>重启iptables即可，对于防火墙不熟悉请勿远程操作。</p>
<p>&nbsp;</p>
<p>方法二：</p>
<p>在master.cf里的非#号开头的第一行,应该是smtp inet n － n －－smtpd</p>
<pre><code>这一行表示的是smtp的进程，和<span class="regexp">/etc/</span>services里的

smtp&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; <span class="number">25</span>/tcp&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; mail

smtp&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; <span class="number">25</span>/udp&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; mail

相对应,再在后追加一行同样的进行，修改一下前面的名字，如

smtp2 inet n －n － － smtpd，

保存后，在<span class="regexp">/etc/</span>services里也相应增加一个服务器进程端口号即可，如：

smtp2&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; <span class="number">2626</span>/tcp&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; mail2

smtp2&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; <span class="number">2626</span>/udp&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; mail2

保存后，reload不行，要restart postfix就应该能同时启动<span class="number">25</span>和<span class="number">2626</span>两个功能完全相同的端口。

参见<span class="string">http:</span><span class="comment">//www.extmail.org/forum/viewthread.php?tid=3787&amp;amp;extra=&amp;amp;page=1</span>
</code></pre></div><footer class="post__foot u-cf"><a href="/2010/01/12/w/e4-bf-ae-e6-94-b9-e9-82-ae-e4-bb-b6smtp-e7-ab-af-e5-8f-a3-e8-a7-a3-e5-86-b3isp-e5-b0-81-e9-94-8125-e7-ab-af-e5-8f-a3-e4-b8-8d-e8-83-bd-e5-8f-91-e4-bf-a1/#comments" class="post__foot-link u-fr">评论</a></footer></article><article class="post"><header class="post__head"><time datetime="2010-01-12T01:20:49.000Z" class="post__time">一月 12, 2010</time><h1 class="post__title"><a href="/2010/01/12/w/e8-ae-be-e7-bd-ae-e8-87-aa-e5-8a-a8-e6-b8-85-e7-90-86mysql-binlog-e6-97-a5-e5-bf-97-e5-92-8c-e6-89-8b-e5-8a-a8-e5-88-a0-e9-99-a4-e7-9a-84-e6-96-b9-e6-b3-95/">设置自动清理mysql binlog日志和手动删除的方法</a></h1></header><div class="post__main"><p>&nbsp; MYSQL主从复制(replication)采用 RBR 模式后，binlog的格式为&quot;ROW&quot;，能解决很多原先出现的主键重复问题。</p>
<pre><code>在一个繁忙的master db server上，binlog日志文件增长速度很快，如果不定时清除，硬盘空间很快就会被充满。

设置自动清理mysql binlog日志，配置my.cnf：

expire_logs_days = 10

在运行时修改：

<span class="operator"><span class="keyword">show</span> <span class="built_in">binary</span> <span class="keyword">logs</span>;</span> 

<span class="operator"><span class="keyword">show</span> <span class="keyword">variables</span> <span class="keyword">like</span> &amp;#<span class="number">39</span>;</span>%log%&amp;#39;; 

<span class="operator"><span class="keyword">set</span> <span class="keyword">global</span> expire_logs_days = <span class="number">10</span>;</span>

清除之前可以采用相应的备份策略。

手动删除10天前的mysql binlog日志：

<span class="operator"><span class="keyword">PURGE</span> <span class="keyword">MASTER</span> <span class="keyword">LOGS</span> <span class="keyword">BEFORE</span> <span class="keyword">DATE_SUB</span>(<span class="keyword">CURRENT_DATE</span>, <span class="built_in">INTERVAL</span> <span class="number">10</span> <span class="keyword">DAY</span>);</span>

<span class="operator"><span class="keyword">show</span> <span class="keyword">master</span> <span class="keyword">logs</span>;</span>

MASTER和BINARY是同义词。
</code></pre><p>一般情况下，推荐使用MIXED binlog的复制。<a href="http://dev.mysql.com/doc/refman/5.1/en/open-bugs-general.html中的说明:Replication" target="_blank" rel="external">http://dev.mysql.com/doc/refman/5.1/en/open-bugs-general.html中的说明:Replication</a> uses query-level logging: The master writes the executed queries to the binary log. This is a very fast, compact, and efficient logging method that works perfectly in most cases. </p>
<pre><code>附：关于MYSQL复制的几种模式

以下转自http://steven1981.itpub.net/post/7967/485747

从 MySQL 5.1.12 开始，可以用以下三种模式来实现：

<span class="comment">-- 基于SQL语句的复制(statement-based replication, SBR)，</span>

<span class="comment">-- 基于行的复制(row-based replication, RBR)，</span>

<span class="comment">-- 混合模式复制(mixed-based replication, MBR)。</span>

相应地，binlog的格式也有三种：STATEMENT，ROW，MIXED。 MBR 模式中，SBR 模式是默认的。

在运行时可以动态改动 binlog的格式，除了以下几种情况：

. 存储流程或者触发器中间

. 启用了NDB

. 当前会话试用 RBR 模式，并且已打开了临时表

如果binlog采用了 MIXED 模式，那么在以下几种情况下会自动将binlog的模式由 SBR 模式改成 RBR 模式。

. 当DML语句更新一个NDB表时

. 当函数中包含 UUID() 时

. 2个及以上包含 AUTO_INCREMENT 字段的表被更新时

. 行任何 <span class="operator"><span class="keyword">INSERT</span> <span class="keyword">DELAYED</span> 语句时

. 用 UDF 时

. 视图中必须要求运用 RBR 时，例如建立视图是运用了 <span class="keyword">UUID</span>() 函数

设定主从复制模式：

<span class="keyword">log</span>-<span class="keyword">bin</span>=mysql-<span class="keyword">bin</span>

#binlog_format=&amp;quot;</span>STATEMENT&amp;quot;

#binlog_format=&amp;quot;ROW&amp;quot;

binlog_format=&amp;quot;MIXED&amp;quot;

也可以在运行时动态修改binlog的格式。例如

mysql&amp;gt; <span class="operator"><span class="keyword">SET</span> <span class="keyword">SESSION</span> binlog_format = &amp;#<span class="number">39</span>;</span>STATEMENT&amp;#39;;

mysql&amp;gt; <span class="operator"><span class="keyword">SET</span> <span class="keyword">SESSION</span> binlog_format = &amp;#<span class="number">39</span>;</span>ROW&amp;#39;;

mysql&amp;gt; <span class="operator"><span class="keyword">SET</span> <span class="keyword">SESSION</span> binlog_format = &amp;#<span class="number">39</span>;</span>MIXED&amp;#39;;

mysql&amp;gt; <span class="operator"><span class="keyword">SET</span> <span class="keyword">GLOBAL</span> binlog_format = &amp;#<span class="number">39</span>;</span>STATEMENT&amp;#39;;

mysql&amp;gt; <span class="operator"><span class="keyword">SET</span> <span class="keyword">GLOBAL</span> binlog_format = &amp;#<span class="number">39</span>;</span>ROW&amp;#39;;

mysql&amp;gt; <span class="operator"><span class="keyword">SET</span> <span class="keyword">GLOBAL</span> binlog_format = &amp;#<span class="number">39</span>;</span>MIXED&amp;#39;;

两种模式各自的优缺点：

SBR 的优点：

历史悠久，技能成熟

binlog文件较小

binlog中包含了所有数据库修改信息，可以据此来审核数据库的安全等情况

binlog可以用于实时的还原，而不仅仅用于复制

主从版本可以不一样，从服务器版本可以比主服务器版本高

SBR 的缺点：

不是所有的<span class="operator"><span class="keyword">UPDATE</span>语句都能被复制，尤其是包含不确定操作的时候。

调用具有不确定因素的 UDF 时复制也可能出疑问

运用以下函数的语句也不能被复制：

* <span class="keyword">LOAD_FILE</span>()

* <span class="keyword">UUID</span>()

* <span class="keyword">USER</span>()

* <span class="keyword">FOUND_ROWS</span>()

* <span class="keyword">SYSDATE</span>() (除非启动时启用了 <span class="comment">--sysdate-is-now 选项)</span>

<span class="keyword">INSERT</span> ... <span class="keyword">SELECT</span> 会产生比 RBR 更多的行级锁

复制须要执行 全表扫描(<span class="keyword">WHERE</span> 语句中没有运用到索引)的 <span class="keyword">UPDATE</span> 时，须要比 RBR 请求更多的行级锁

对于有 AUTO_INCREMENT 字段的 <span class="keyword">InnoDB</span>表而言，<span class="keyword">INSERT</span> 语句会阻塞其他 <span class="keyword">INSERT</span> 语句

对于一些复杂的语句，在从服务器上的耗资源情况会更严重，而 RBR 模式下，只会对那个发生变化的记录产生影响

存储函数(不是存储流程 )在被调用的同时也会执行一次 <span class="keyword">NOW</span>() 函数，这个可以说是坏事也可能是好事

确定了的 UDF 也须要在从服务器上执行

数据表必须几乎和主服务器保持一致才行，否则可能会导致复制出错

执行复杂语句如果出错的话，会消耗更多资源

RBR 的优点：

任何情况都可以被复制，这对复制来说是最安全可靠的

和其他大多数数据库系统的复制技能一样

多数情况下，从服务器上的表如果有主键的话，复制就会快了很多

复制以下几种语句时的行锁更少：

* <span class="keyword">INSERT</span> ... <span class="keyword">SELECT</span>

* 包含 AUTO_INCREMENT 字段的 <span class="keyword">INSERT</span>

* 没有附带条件或者并没有修改很多记录的 <span class="keyword">UPDATE</span> 或 <span class="keyword">DELETE</span> 语句

执行 <span class="keyword">INSERT</span>，<span class="keyword">UPDATE</span>，<span class="keyword">DELETE</span> 语句时锁更少

从服务器上采用多线程来执行复制成为可能

RBR 的缺点：

<span class="keyword">binlog</span> 大了很多

复杂的回滚时 <span class="keyword">binlog</span> 中会包含大量的数据

主服务器上执行 <span class="keyword">UPDATE</span> 语句时，所有发生变化的记录都会写到 <span class="keyword">binlog</span> 中，而 SBR 只会写一次，这会导致频繁发生 <span class="keyword">binlog</span> 的并发写疑问

UDF 产生的大 <span class="built_in">BLOB</span> 值会导致复制变慢

不能从 <span class="keyword">binlog</span> 中看到都复制了写什么语句(加密过的)

当在非事务表上执行一段堆积的<span class="keyword">SQL</span>语句时，最好采用 SBR 模式，否则很容易导致主从服务器的数据不一致情况发生

另外，针对系统库 mysql 里面的表发生变化时的处理准则如下：

如果是采用 <span class="keyword">INSERT</span>，<span class="keyword">UPDATE</span>，<span class="keyword">DELETE</span> 直接操作表的情况，则日志格式根据 binlog_format 的设定而记录

如果是采用 <span class="keyword">GRANT</span>，<span class="keyword">REVOKE</span>，<span class="keyword">SET</span> <span class="keyword">PASSWORD</span> 等管理语句来做的话，那么无论如何 都采用 SBR 模式记录。

注：采用 RBR 模式后，能处理很多原先出现的主键重复问题。实例:

对于<span class="keyword">insert</span> <span class="keyword">into</span> db_allot_ids <span class="keyword">select</span> * <span class="keyword">from</span> db_allot_ids 这个语句:

在BINLOG_FORMAT=STATEMENT 模式下:

<span class="keyword">BINLOG</span>日志信息为:

<span class="comment">-----------------------------------------</span>

<span class="keyword">BEGIN</span>

<span class="comment">/*!*/</span>;</span>

# at 173

#090612 16:05:42 server id 1 end_log_pos 288 Query thread_id=4 exec_time=0 error_code=0

<span class="operator"><span class="keyword">SET</span> <span class="keyword">TIMESTAMP</span>=<span class="number">1244793942</span><span class="comment">/*!*/</span>;</span>

<span class="operator"><span class="keyword">insert</span> <span class="keyword">into</span> db_allot_ids <span class="keyword">select</span> * <span class="keyword">from</span> db_allot_ids

<span class="comment">/*!*/</span>;</span>

<span class="comment">-----------------------------------------</span>

在BINLOG_FORMAT=ROW 模式下:

BINLOG日志信息为:

<span class="comment">-----------------------------------------</span>

BINLOG &amp;#39;

hA0yShMBAAAAMwAAAOAAAAAAAA8AAAAAAAAAA1NOUwAMZGJfYWxsb3RfaWRzAAIBAwAA

hA0yShcBAAAANQAAABUBAAAQAA8AAAAAAAEAAv/8AQEAAAD8AQEAAAD8AQEAAAD8AQEAAAA=

&amp;#39;<span class="comment">/*!*/</span>;

<span class="comment">-----------------------------------------</span>
</code></pre></div><footer class="post__foot u-cf"><a href="/2010/01/12/w/e8-ae-be-e7-bd-ae-e8-87-aa-e5-8a-a8-e6-b8-85-e7-90-86mysql-binlog-e6-97-a5-e5-bf-97-e5-92-8c-e6-89-8b-e5-8a-a8-e5-88-a0-e9-99-a4-e7-9a-84-e6-96-b9-e6-b3-95/#comments" class="post__foot-link u-fr">评论</a></footer></article><article class="post"><header class="post__head"><time datetime="2010-01-06T07:30:58.000Z" class="post__time">一月 6, 2010</time><h1 class="post__title"><a href="/2010/01/06/w/e4-bb-8eu-e7-9b-98-e7-a7-bb-e5-8a-a8-e7-a1-ac-e7-9b-98-ef-bc-88usb-hd-ef-bc-89-e5-ae-89-e8-a3-85centos-5-x86-64-linux/">从u盘/移动硬盘（usb hd）安装centos 6 、centos 5 x86_64 linux</a></h1></header><div class="post__main"><p>安装Linux主要有三种方法</p>
<pre><code>1、光盘

2、网络

3、<span class="keyword">u</span>盘/移动硬盘

光盘安装最简单，也是最常用的。网络安装很方便，速度也快，nfs镜像适合快速安装大量机器。但<span class="keyword">U</span>盘安装更方便，安装的速度比光盘快，也不需要光驱和刻盘。
</code></pre><p>这里以一个20g的移动硬盘为例介绍一下安装过程，U盘类似：</p>
<p>假设移动硬盘是sdb，分区需要在linux中用fdisk（windows环境可以用DiskGenius.exe），</p>
<p>分为三个区：</p>
<p>sdb1，4G，fat32（可以安装live linux，参见<a href="http://veryi.com/w/257.html" target="_blank" rel="external">http://veryi.com/w/257.html</a>）；</p>
<p>sdb2，10G，ntfs（用于存放大于4个G的文件）；</p>
<p>sdb3，5G，ext2。在linux中使用以下命令格式化：</p>
<p>mkfs -t ext2 /dev/sdb3。</p>
<p>&nbsp;</p>
<p>centos 6 安装设定：</p>
<p>mkdir -p /mnt/iso</p>
<pre><code>mkdir -p <span class="regexp">/mnt/</span>sdb1

mount -o CentOS-<span class="number">6.0</span>-i386-bin-DVD.iso <span class="regexp">/mnt/i</span>so

mount <span class="regexp">/dev/</span>sdb1 <span class="regexp">/mnt/</span>sdb1
</code></pre><p>cp -a /mnt/iso/isolinux /mnt/sdb1</p>
<pre><code>umount <span class="regexp">/mnt/</span>sdb1
</code></pre><p>复制CentOS-6.0-i386-bin-DVD.iso到ext2分区：</p>
<pre><code>mkdir -p <span class="regexp">/mnt/</span>sdb3

mount&amp;nbsp; <span class="regexp">/dev/</span>sdb3 <span class="regexp">/mnt/</span>sdb3
</code></pre><p>cp CentOS-6.0-i386-bin-DVD.iso /mnt/sdb3</p>
<p>对于CentOS-6.0-i386还需要复制install.img，在CentOS-6.0-i386-bin-DVD.iso文件里的images目录里。</p>
<pre><code>mkdir -p <span class="regexp">/mnt/</span>sdb3/images

cp <span class="regexp">/mnt/</span>iso<span class="regexp">/images/</span>install.img <span class="regexp">/mnt/</span>sdb3/images

umount <span class="regexp">/mnt/</span>sdb3
</code></pre><p>&nbsp;</p>
<p>CentOS 5安装配置：</p>
<p>复制CentOS-5.4-x86_64-bin-DVD.iso到ext2分区：</p>
<p>mount&nbsp; /dev/sdb3 /mnt</p>
<p>cp CentOS-5.4-x86_64-bin-DVD.iso /mnt</p>
<p>umount /mnt</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>复制linux系统引导文件到sdb1分区：</p>
<p>mkdir -p /mnt/iso</p>
<pre><code>mkdir -<span class="tag">p</span> /mnt/sdb1
</code></pre><p>对于centos 5</p>
<pre><code>mount -o loop CentOS-<span class="number">5.4</span>-x86_64-bin-DVD.iso <span class="regexp">/mnt/i</span>so

mount <span class="regexp">/dev/</span>sdb1 <span class="regexp">/mnt/</span>sdb1

cp -a <span class="regexp">/mnt/i</span>so<span class="regexp">/isolinux /m</span>nt<span class="regexp">/sdb1</span>
</code></pre><p>对于centos 6</p>
<pre><code>mount -o loop CentOS-<span class="number">6.0</span>-i386-bin-DVD.iso <span class="regexp">/mnt/i</span>so

mount <span class="regexp">/dev/</span>sdb1 <span class="regexp">/mnt/</span>sdb1

cp -a <span class="regexp">/mnt/i</span>so<span class="regexp">/isolinux /m</span>nt<span class="regexp">/sdb1</span>
</code></pre><p>CentOS6直接放在第一个分区就可以了。因为在linux的安装过程中不能识别ntfs分区，而CentOS-5.4-x86_64-bin-DVD.iso、CentOS-6.0-i386-bin-DVD.iso超过了4个G，fat32分区单文件的上限是4G，所以把iso文件放在ext2分区。</p>
<p>&nbsp;</p>
<p>安装<a href="http://sourceforge.net/projects/grub4dos/" target="_blank" rel="external">grub4dos</a>，将引导代码写入U盘mbr：</p>
<pre><code>W<span class="keyword">in</span>32下，运行grubinst_gui.exe ，在&amp;ldquo;磁盘&amp;rdquo;处选中U盘，在&amp;ldquo;选项&amp;rdquo;区选中&amp;ldquo;不保存原来的mbr&amp;rdquo;、&amp;ldquo;不引导原来的mbr&amp;rdquo;、&amp;ldquo;启动时不搜索软盘&amp;rdquo;，点击&amp;ldquo;安装&amp;rdquo;即可。
</code></pre><p>拷贝grub.exe、grldr到u盘fat32分区根目录，编辑menu.lst，加入：</p>
<p>title CentOS-5.4-x86_64 install</p>
<pre><code>&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; root (hd0,<span class="number">0</span>)

&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; kernel <span class="regexp">/isolinux/</span>vmlinuz

&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; initrd <span class="regexp">/isolinux/i</span>nitrd.img
</code></pre><p>对于centos 6:</p>
<p>title CentOS-6 from usb key/hdd install</p>
<pre><code>&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; root (hd0,<span class="number">0</span>)

&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; kernel <span class="regexp">/isolinux/</span>vmlinuz

&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp; initrd <span class="regexp">/isolinux/i</span>nitrd.img
</code></pre><p>把要安装的服务器设为usb设备优先引导，grub加载后，选择CentOS-5.4-x86_64 install，</p>
<p>然后是linux初始化，</p>
<p>到选择安装介质时选择</p>
<p>local disk（本地硬盘），硬盘分区选择</p>
<p>/dev/sdb3（根据实际环境而定，一般是/dev/sdb1），目录选择/(如果iso文件放在/iso目录，就写/iso)。</p>
<p>在这里，服务器自己的本地硬盘被当成sda,移动硬盘被当成sdb，如果服务器有二块硬盘，移动硬盘就是sdc。</p>
<p>系统自动找到镜像，后面的安装过程同光盘安装。</p>
<p>其它版本，如果是CentOS-5.4-i386-bin-DVD.iso，不到4G，就不用这么复杂，复制到ext2分区，直接放到fat32分区就可以了。</p>
<p>如果是Ubuntu系列，直接从live cd安装即可。</p>
<p>注意分区是选择&ldquo;定制&rdquo;，grub的安装位置应该是本地硬盘（sda或hda），而不是U盘（sdb等），如果不是本机引导硬盘，在高级选项里调整一下硬盘位置，把本地硬盘上调到第一位，否则安装完可能不能启动，出现grub就停止不动了。</p>
</div><footer class="post__foot u-cf"><a href="/2010/01/06/w/e4-bb-8eu-e7-9b-98-e7-a7-bb-e5-8a-a8-e7-a1-ac-e7-9b-98-ef-bc-88usb-hd-ef-bc-89-e5-ae-89-e8-a3-85centos-5-x86-64-linux/#comments" class="post__foot-link u-fr">评论</a></footer></article></main><aside class="site-aside"><div class="widget about"><div class="b"><div class="info u-cf"><img src="/avatar.jpg"><div class="text"> <p>dayu graceful</p><p>vegan</p><p>linux sysadm</p><p> <a href="dayu2829@sina.com" title="wiebo" class="weibo ico"></a><a href="kindquiet@qq.com" title="qq" class="qq ico"></a></p></div></div></div></div><div class="widget tags"><div class="h">categories</div><div class="b"> <ul><li><a href="/categories/计算机/">计算机</a><small>(136)</small></li><li><a href="/categories/佛法传统文化/">佛法传统文化</a><small>(18)</small></li><li><a href="/categories/健康/">健康</a><small>(13)</small></li><li><a href="/categories/学习/">学习</a><small>(3)</small></li><li><a href="/categories/网络/">网络</a><small>(1)</small></li><li><a href="/categories/佛法传统文化/健康/">健康</a><small>(1)</small></li></ul></div></div><div class="widget links"><div class="h">links</div><div class="b"> <ul><li><a href="http://www.enzymesos.com/">酵素Enzyme救地球</a></li><li><a href="http://www.osalt.com/">商业软件的开源替代品</a></li></ul></div></div></aside></section><footer class="site-foot"><div class="inner"><div class="site-copy u-fl">© 2015 dayu<bdi> ❤ Theme by <a href="http://riny.net" target="_blank">Bubblings</a></bdi></div><menu class="page-menu u-fr"><li class="page-menu__item"><a title="Previous" href="/page/11/" class="page-menu__link icon-arrow-left">prev</a></li><li class="page-menu__item"><a title="Next" href="/page/13/" class="page-menu__link icon-arrow-right">next</a></li></menu></div></footer><div id="back-top" title="返回顶部"></div><script src="/js/script.js"></script></body></html>